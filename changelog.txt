= Changelog =

2.4.3 – 2026-02-17
Fix – PHP Fatal "Maximum execution time exceeded" during image processing (Imagick) when creating products.
Fix – Sub-batch size reduced from 10 to 5 products to stay within 60-second PHP timeout on shared hosting.
Add – Stall recovery: if sync has no progress for 120+ seconds (PHP timeout killed the job), auto-reschedules from last position.
Add – Batch position (page + offset) saved before processing so recovery knows exactly where to resume.

2.4.2 – 2026-02-17
Fix – Sync stopping at 99 products instead of processing all ~2600.
Fix – The ewheel API sometimes returns fewer than 50 products per page (e.g. 49) even when more pages exist.
Fix – Old logic: "partial page = last page" → stopped early. New logic: always fetch next page, stop only on empty page.

2.4.1 – 2026-02-17
Fix – Sync stalling between sub-batches on shared hosting (Action Scheduler jobs not picked up).
Add – Admin polling now nudges Action Scheduler to process pending jobs when sync stalls for 30+ seconds.
Fix – WP Cron is lazy on shared hosting (only fires on page visits); AJAX polls didn't trigger it.

2.4.0 – 2026-02-17
Fix – Lifecycle reconciliation no longer sets products to draft incorrectly.
Fix – Sync uses Active=1 filter (only ~99 products) but reconciliation compared against all ~2600 ewheel products — any inactive product got unpublished.
Fix – Reconciliation disabled while Active filter is in use (filtered subset ≠ full catalog).
Perf – Removed per-sub-batch active_refs option writes (no longer needed without reconciliation).

2.3.9 – 2026-02-17
Fix – Dashboard product count now uses Active filter, matching what the sync actually imports.
Fix – Count showed ~2600 (all products) while sync only imports ~99 active ones, making it look stuck at 99.

2.3.8 – 2026-02-17
Fix – Family/subfamily category creation no longer fails when API returns a product description in the family field.
Fix – Length guard (200 chars max) on family/subfamily names prevents bad API data from creating garbage categories.

2.3.7 – 2026-02-17
Fix – Translation failures (HTTP 500) when processing 50 products per batch — too many strings for OpenRouter.
Add – Sub-batching: API pages fetched at 50 (reliable pagination), processed 10 at a time (manageable translation load).
Tweak – 5-second delay between sub-batches, 15-second delay between API pages for shared hosting.
Fix – Failure retry now preserves sub-batch offset (no duplicate processing on retry).

2.3.6 – 2026-02-17
Fix – API PageSize fixed to 50 (matching API default) for reliable pagination during sync.
Fix – Small PageSize (10) caused the ewheel API to return inconsistent product counts (59 one run, 39 the next).
Revert – Product count reverted to show all products (Active filter was not the issue).

2.3.5 – 2026-02-17
Fix – Product count now uses Active filter, matching what the sync actually imports.
Fix – Dashboard count was showing ~2600 (all products) while sync only imports ~39 active ones.

2.3.4 – 2026-02-12
Fix – Stale Action Scheduler batch jobs from previous syncs no longer import extra products.
Fix – Sync ID validation added at start of each batch to reject orphaned jobs.
Fix – Starting a new sync now clears any pending batch jobs from previous syncs.

2.3.3 – 2026-02-12
Add – Model name mappings stored in database (WP option) instead of hardcoded constant.
Add – New "Models" admin tab to view, edit, add, and delete model ID → scooter name mappings.
Add – Inline editing with search/filter and unmapped model ID detection.
Tweak – Default 84 model names auto-seeded on activation/upgrade.
Dev – New ModelServiceTest with 12 tests for database-backed mapping.

2.3.2 – 2026-02-11
Add – Image alt text and title set from product name during import (SEO improvement).
Add – Existing images backfill alt text on next sync if missing (no re-download needed).
Dev – New ImageServiceTest with 5 tests for metadata handling.

2.3.1 – 2026-02-11
Add – Family/subfamily now created as WooCommerce product categories (parent-child hierarchy).
Add – Catalogs now created as WooCommerce product tags.
Fix – Translation prompts now include scooter/bike domain glossary (23 terms) for correct Romanian terminology.
Tweak – Pipe data family/subfamily takes precedence; API attributes are fallback.
Dev – 4 new tests for taxonomy field extraction (203 tests total).

2.3.0 – 2026-02-11
Fix – Family, subfamily, and catalogs no longer created as product attributes or used for variations.
Tweak – familia-sage, subfamilia-sage, subfamilia, catalogos moved from hidden attributes to meta storage.
Tweak – Pipe-extracted family/subfamily now stored as _ewheel_family/_ewheel_subfamily meta instead of WooCommerce attributes.

2.2.9 – 2026-02-11
Add – Price rounding setting: none, round up to integer, .99 ending, nearest 5, nearest 10.
Add – Price Rounding dropdown in Pricing Settings section.
Dev – 11 new tests for rounding modes (199 tests total).

2.2.8 – 2026-02-11
Add – Shipping dimensions (weight, height, width, length) extracted from variant attributes.
Fix – Simple-expanded products now populate WooCommerce shipping fields from variant-level peso/alto/ancho/largo.
Dev – 1 new test for variant dimension extraction (188 tests total).

2.2.7 – 2026-02-11
Fix – Product names no longer contain garbage variant metadata (IDs, dates, barcodes, etc.).
Fix – Single-variant products skip the variant suffix entirely (nothing to disambiguate).
Fix – Multi-variant name suffix now only includes visible attributes (color, size, etc.).
Dev – 2 new tests for product name generation (187 tests total).

2.2.6 – 2026-02-11
Perf – Bulk product lookup cache: ~7,000 individual DB queries replaced with 3 bulk queries.
Perf – wp_cache_flush() moved from per-product to per-batch (reduces overhead).
Add – ProductLookupCache class for O(1) SKU/reference existence checks during sync.
Dev – 16 new unit tests for ProductLookupCache (185 tests total).

2.2.5 – 2026-02-11
Fix – Single-variant products now created as simple (SKU, GTIN populated correctly).
Fix – Barcode extraction from variant attributes (codigo-alternativo EAN/UPC).
Dev – Removed debug logging from ProductTransformer.

2.2.4 – 2026-02-10
Add – Auto-detect product type: products with variants → variable, without → simple.
Tweak – Product Type Mode default changed to "Auto-detect".

2.2.3 – 2026-02-10
Tweak – Default product type mode changed to "simple" (no variable products).
Add – Product Type Mode dropdown in Settings (simple vs variable).

2.2.2 – 2026-02-10
Fix – Polling resilience: JS errors no longer kill the status poller (try-catch guard).
Add – Stock sync phase now shows "Syncing stock levels..." instead of appearing stuck.
Tweak – Defensive null checks on poll response data.

2.2.1 – 2026-02-10
Fix – Category mapping lost numeric string keys due to array_merge() re-indexing.
Add – Live progress bar with percentage during sync (uses cached product count).
Add – Total product count included in sync status API responses.

2.2.0 – 2026-02-09
Add – Scheduled automatic sync via WP Cron (incremental, only changed products).
Add – Email notification to admin when sync completes or fails.
Add – Build script --release flag for one-command commit, push, build, and GitHub release.
Tweak – Cron reschedules automatically when sync frequency setting is changed.
Dev – Added .phpunit.result.cache to .gitignore, cleaned up old ZIP artifacts.

2.1.2 – 2026-02-08
Fix – Auto-updater initializes before WooCommerce requirement checks (plugin load order).
Fix – PUC reported wrong version because tagged commit had outdated plugin header.
Dev – Cleaned up stale GitHub releases and tags (v2.0.7–v2.1.1).

2.1.1 – 2026-02-07
Add – Resume from last sync position (continue from where a previous sync left off).

2.1.0 – 2026-02-06
Fix – Product count no longer auto-paginates all 52 API pages on admin page load.
Add – Cached product count in transient with manual refresh button.
Tweak – Silent API logging (no more console noise on every request).

2.0.9 – 2026-02-05
Tweak – Combined AJAX polling endpoint (status + logs in single request).
Tweak – Page Visibility API pauses polling when browser tab is hidden.
Tweak – Reduced batch size from 10 to 5, increased inter-batch delay from 5s to 15s.
Fix – Shared hosting compatibility improvements for long-running syncs.

2.0.8 – 2026-02-04
Fix – MariaDB compatibility: removed LIMIT in subqueries (unsupported).
Add – Auto-updater diagnostics logging for troubleshooting PUC issues.

2.0.0 – 2026-02-03
Add – Translation retry with exponential backoff on provider failure.
Add – Translation health check before each batch.
Add – Batch abort when translation provider is consistently failing.
Fix – Prevent double-translation of multilingual attribute values.

1.9.0 – 2026-02-02
Dev – Full test suite green: 169 tests, 338 assertions.
Fix – Security hardening (nonce checks, capability checks, input sanitization).

1.8.0 – 2026-02-01
Add – Stock synchronization with full API pagination support.
Add – Sale price support (regular and sale prices from API).
Add – Product lifecycle reconciliation (unpublish products removed from API).
